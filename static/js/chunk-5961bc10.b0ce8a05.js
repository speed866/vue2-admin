(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5961bc10"],{"0254":function(t,e,a){},"13d5":function(t,e,a){"use strict";var n=a("23e7"),s=a("d58f").left,r=a("a640"),i=a("ae40"),u=r("reduce"),l=i("reduce",{1:0});n({target:"Array",proto:!0,forced:!u||!l},{reduce:function(t){return s(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},7220:function(t,e,a){"use strict";a("0254")},"742b":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-card",{staticStyle:{margin:"20px 0"}},[a("CategorySelect",{on:{getCategoryId:t.getCategoryId}})],1),a("el-card",[a("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary",disabled:!t.category3Id},on:{click:t.addSpu}},[t._v("添加Spu")]),a("el-table",{attrs:{border:"",data:t.spuList}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),a("el-table-column",{attrs:{label:"spu名称",prop:"spuName"}}),a("el-table-column",{attrs:{label:"spu描述",prop:"description"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"添加sku",placement:"bottom","open-delay":500}},[a("el-button",{attrs:{type:"success",icon:"el-icon-plus",size:"mini"},on:{click:function(e){return t.addSku(n)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"修改spu",placement:"bottom","open-delay":500}},[a("el-button",{attrs:{type:"warning",icon:"el-icon-edit",size:"mini"},on:{click:function(e){return t.updateSpu(n)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"查看当前spu的sku列表",placement:"bottom","open-delay":500}},[a("el-button",{attrs:{type:"info",icon:"el-icon-info",size:"mini"},on:{click:function(e){return t.SkuList(n)}}})],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除spu",placement:"bottom","open-delay":500}},[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.delSpu(n)}}})],1)]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"center"},attrs:{"current-page":t.page,"page-sizes":[3,5,10],"page-size":t.limit,layout:"prev, pager, next, jumper, ->, sizes, total",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:t.spu.id?"编辑Spu":"添加Spu",visible:t.showSpu},on:{"update:visible":function(e){t.showSpu=e}}},[a("el-form",{attrs:{"label-width":"80px",model:t.spu}},[a("el-form-item",{attrs:{label:"SPU名称"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{placeholder:"SPU名称"},model:{value:t.spu.spuName,callback:function(e){t.$set(t.spu,"spuName",e)},expression:"spu.spuName"}})],1),a("el-form-item",{attrs:{label:"品牌"}},[a("el-select",{attrs:{placeholder:"请选择品牌"},model:{value:t.spu.tmId,callback:function(e){t.$set(t.spu,"tmId",e)},expression:"spu.tmId"}},t._l(t.tradeMarkList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.tmName,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:"SPU描述"}},[a("el-input",{staticStyle:{width:"50%"},attrs:{type:"textarea",placeholder:"请输入内容",autosize:""},model:{value:t.spu.description,callback:function(e){t.$set(t.spu,"description",e)},expression:"spu.description"}})],1),a("el-form-item",{attrs:{label:"SPU图片"}},[a("el-upload",{attrs:{action:"/dev-api/admin/product/fileUpload","list-type":"picture-card","file-list":t.spuImgList,"on-change":t.handleChange}},[a("i",{staticClass:"el-icon-plus"})]),a("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("img",{attrs:{width:"50%",src:t.dialogImageUrl,alt:""}})])],1),a("el-form-item",{attrs:{label:"销售属性"}},[a("el-select",{attrs:{placeholder:t.unSelectSaleAttr.length>0?"还有"+t.unSelectSaleAttr.length+"未选择":"无"},model:{value:t.attrId,callback:function(e){t.attrId=e},expression:"attrId"}},t._l(t.unSelectSaleAttr,(function(t){return a("el-option",{key:t.id,attrs:{value:t.name+":"+t.id,label:t.name}})})),1),a("el-button",{staticStyle:{margin:"0 10px"},attrs:{disabled:!t.attrId,icon:"el-icon-plus",type:"primary"},on:{click:t.addSaleAttr}},[t._v("添加销售属性")])],1)],1),a("el-table",{attrs:{border:"",data:t.spu.spuSaleAttrList}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"80",align:"center"}}),a("el-table-column",{attrs:{label:"属性名",prop:"saleAttrName"}}),a("el-table-column",{attrs:{label:"属性值名称列表"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._l(n.spuSaleAttrValueList,(function(e,s){return a("el-tag",{key:e.id,attrs:{closable:"","disable-transitions":!1},on:{close:function(t){return n.spuSaleAttrValueList.splice(s,1)}}},[t._v(" "+t._s(e.saleAttrValueName)+" ")])})),n.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:function(e){return t.handleInputConfirm(n)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(n)}},model:{value:n.inputValue,callback:function(e){t.$set(n,"inputValue",e)},expression:"row.inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:function(e){return t.showInput(n)}}},[t._v("+ 添加")])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.$index;return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.spu.spuSaleAttrList.splice(n,1)}}})]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showSpu=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"添加Sku",visible:t.showSku},on:{"update:visible":function(e){t.showSku=e}}},[a("el-form",{attrs:{"label-width":"100px",model:t.skuInfo}},[a("el-form-item",{attrs:{label:"Spu名称"}},[t._v(t._s(t.skuInfo.spuName))]),a("el-form-item",{attrs:{label:"Sku名称"}},[a("el-input",{attrs:{placeholder:"Sku名称"},model:{value:t.skuInfo.skuName,callback:function(e){t.$set(t.skuInfo,"skuName",e)},expression:"skuInfo.skuName"}})],1),a("el-form-item",{attrs:{label:"价格(元)"}},[a("el-input",{attrs:{placeholder:"价格（元）"},model:{value:t.skuInfo.price,callback:function(e){t.$set(t.skuInfo,"price",e)},expression:"skuInfo.price"}})],1),a("el-form-item",{attrs:{label:"重量(千克)"}},[a("el-input",{attrs:{placeholder:"重量（千克）"},model:{value:t.skuInfo.weight,callback:function(e){t.$set(t.skuInfo,"weight",e)},expression:"skuInfo.weight"}})],1),a("el-form-item",{attrs:{label:"规格描述"}},[a("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"规格描述"},model:{value:t.skuInfo.skuDesc,callback:function(e){t.$set(t.skuInfo,"skuDesc",e)},expression:"skuInfo.skuDesc"}})],1),a("el-form-item",{attrs:{label:"平台属性"}},[a("el-form",{attrs:{inline:!0}},t._l(t.attrInfoList,(function(e){return a("el-form-item",{key:e.id,attrs:{label:e.attrName}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.attrIdAndValueId,callback:function(a){t.$set(e,"attrIdAndValueId",a)},expression:"item.attrIdAndValueId"}},t._l(e.attrValueList,(function(t){return a("el-option",{key:t.id,attrs:{value:e.id+":"+t.id,label:t.valueName}})})),1)],1)})),1)],1),a("el-form-item",{attrs:{label:"销售属性"}},[a("el-form",{attrs:{inline:!0}},t._l(t.spuSaleAttrList,(function(e){return a("el-form-item",{key:e.id,attrs:{label:e.saleAttrName}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.attrIdAndValueId,callback:function(a){t.$set(e,"attrIdAndValueId",a)},expression:"item.attrIdAndValueId"}},t._l(e.spuSaleAttrValueList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.saleAttrValueName,value:e.id+":"+t.id}})})),1)],1)})),1)],1),a("el-form-item",{attrs:{label:"图片列表"}},[a("el-table",{attrs:{border:"",data:t.skuImageList},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",label:"序号",width:"80"}}),a("el-table-column",{attrs:{label:"图片"},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.row;return[a("img",{attrs:{src:e.imgUrl,alt:"",width:"100px"}})]}}])}),a("el-table-column",{attrs:{label:"名称",prop:"imgName"}}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[0===n.isDefault?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.changeDefault(n)}}},[t._v("设为默认")]):a("el-button",{attrs:{size:"mini"}},[t._v("默认")])]}}])})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showSku=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.submitSku}},[t._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:t.spuName+"的sku列表",visible:t.showSkuList},on:{"update:visible":function(e){t.showSkuList=e}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.skuList,border:""}},[a("el-table-column",{attrs:{label:"名称",prop:"skuName"}}),a("el-table-column",{attrs:{label:"价格",prop:"price"}}),a("el-table-column",{attrs:{label:"重量",prop:"weight"}}),a("el-table-column",{attrs:{label:"默认图片"},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.row;return[a("img",{attrs:{src:e.skuDefaultImg,alt:"",width:"100px"}})]}}])})],1)],1)],1)},s=[],r=a("5530");function i(t){if(Array.isArray(t))return t}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function u(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var n,s,r,i,u=[],l=!0,o=!1;try{if(r=(a=a.call(t)).next,0===e){if(Object(a)!==a)return;l=!1}else for(;!(l=(n=r.call(a)).done)&&(u.push(n.value),u.length!==e);l=!0);}catch(t){o=!0,s=t}finally{try{if(!l&&null!=a["return"]&&(i=a["return"](),Object(i)!==i))return}finally{if(o)throw s}}return u}}a("fb6a"),a("25f0"),a("b0c0"),a("a630"),a("ac1f"),a("00b4");function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function o(t,e){if(t){if("string"===typeof t)return l(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?l(t,e):void 0}}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(t,e){return i(t)||u(t,e)||o(t,e)||c()}var p=a("c7eb"),f=a("1da1"),m=(a("4de4"),a("159b"),a("498a"),a("d81d"),a("13d5"),a("99af"),a("b775")),g=function(t,e,a){return m["a"].get("/admin/product/".concat(t,"/").concat(e),{params:{category3Id:a}})},b=function(t){return m["a"].get("/admin/product/getSpuById/".concat(t))},h=function(){return m["a"].get("/admin/product/baseTrademark/getTrademarkList")},I=function(t){return m["a"].get("/admin/product/spuImageList/".concat(t))},k=function(){return m["a"].get("/admin/product/baseSaleAttrList")},S=function(t){return t.id?m["a"].post("/admin/product/updateSpuInfo",t):m["a"].post("/admin/product/saveSpuInfo",t)},v=function(t){return m["a"].delete("/admin/product/deleteSpu/".concat(t))},y=function(t){return m["a"].get("/admin/product/spuSaleAttrList/".concat(t))},w=function(t,e,a){return m["a"].get("/admin/product/attrInfoList/".concat(t,"/").concat(e,"/").concat(a))},L=function(t){return m["a"].post("/admin/product/saveSkuInfo",t)},A=function(t){return m["a"].get("/admin/product/findBySpuId/".concat(t))},x={name:"SpuIndex",data:function(){return{category1Id:"",category2Id:"",category3Id:"",page:1,limit:3,spuList:[],total:0,showSpu:!1,showSku:!1,dialogImageUrl:"",dialogVisible:!1,spu:{category3Id:0,description:"",tmId:"",spuName:"",spuImageList:[],spuSaleAttrList:[]},tradeMarkList:[],spuImgList:[],saleAttrList:[],attrId:"",spuSaleAttrList:[],attrInfoList:[],skuImageList:[],selectImageList:[],skuInfo:{category3Id:0,spuId:0,tmId:0,spuName:"",skuName:"",price:"",weight:"",skuDefaultImg:"",skuDesc:"",skuAttrValueList:[],skuImageList:[],skuSaleAttrValueList:[]},defaultSkuInfo:{category3Id:0,spuId:0,tmId:0,spuName:"",skuName:"",price:"",weight:"",skuDefaultImg:"",skuDesc:"",skuAttrValueList:[],skuImageList:[],skuSaleAttrValueList:[]},showSkuList:!1,skuList:[],spuName:"",loading:!1}},computed:{unSelectSaleAttr:function(){var t=this;return this.saleAttrList.filter((function(e){return t.spu.spuSaleAttrList.every((function(t){return e.name!==t.saleAttrName}))}))}},methods:{getCategoryId:function(t){var e=t.categoryId,a=t.level;1===a?(this.category1Id=e,this.category2Id="",this.category3Id=""):2===a?(this.category2Id=e,this.category3Id=""):(this.category3Id=e,this.getSpuList())},getSpuList:function(){var t=this;return Object(f["a"])(Object(p["a"])().mark((function e(){var a,n,s,r;return Object(p["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.page,n=t.limit,s=t.category3Id,e.next=3,g(a,n,s);case 3:r=e.sent,200===r.code&&(t.total=r.data.total,t.spuList=r.data.records);case 5:case"end":return e.stop()}}),e)})))()},handleSizeChange:function(t){this.limit=t,this.getSpuList()},handleCurrentChange:function(t){this.page=t,this.getSpuList()},addSpu:function(){var t=this;return Object(f["a"])(Object(p["a"])().mark((function e(){var a,n;return Object(p["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.spu={category3Id:0,description:"",tmId:"",spuName:"",spuImageList:[],spuSaleAttrList:[]},t.showSpu=!0,e.next=4,h();case 4:return a=e.sent,200===a.code&&(t.tradeMarkList=a.data),e.next=8,k();case 8:n=e.sent,200===n.code&&(t.saleAttrList=n.data),t.spu.category3Id=t.category3Id;case 11:case"end":return e.stop()}}),e)})))()},delSpu:function(t){var e=this;this.$confirm("确认删除吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(f["a"])(Object(p["a"])().mark((function a(){return Object(p["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,v(t.id);case 2:e.$message({type:"success",message:"删除成功!"}),e.spuList.length<=1&&(e.page-=1),e.getSpuList();case 5:case"end":return a.stop()}}),a)})))).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},updateSpu:function(t){this.showSpu=!0,this.initSpuData(t)},handleChange:function(t,e){this.spuImgList=e},initSpuData:function(t){var e=this;return Object(f["a"])(Object(p["a"])().mark((function a(){var n,s,r,i,u;return Object(p["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,b(t.id);case 2:return n=a.sent,200===n.code&&(e.spu=n.data),a.next=6,h();case 6:return s=a.sent,200===s.code&&(e.tradeMarkList=s.data),a.next=10,I(t.id);case 10:return r=a.sent,200===r.code&&(i=r.data,i.forEach((function(t){t.name=t.imgName,t.url=t.imgUrl})),e.spuImgList=i),a.next=14,k();case 14:u=a.sent,200===u.code&&(e.saleAttrList=u.data);case 16:case"end":return a.stop()}}),a)})))()},showInput:function(t){var e=this;this.$set(t,"inputVisible",!0),this.$set(t,"inputValue",""),this.$nextTick((function(t){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(t){var e=this,a=t.inputValue,n=t.baseSaleAttrId;if(""===t.inputValue.trim())return this.$message("输入不得为空"),void this.$nextTick((function(t){e.$refs.saveTagInput.$refs.input.focus()}));var s=t.spuSaleAttrValueList.every((function(t){return t.saleAttrValueName!==a}));if(!s)return this.$message("属性值重复"),void this.$nextTick((function(t){e.$refs.saveTagInput.$refs.input.focus()}));var r={saleAttrValueName:a,baseSaleAttrId:n};t.spuSaleAttrValueList.push(r),t.inputVisible=!1},addSaleAttr:function(){var t=this.attrId.split(":"),e=d(t,2),a=e[0],n=e[1],s={baseSaleAttrId:n,saleAttrName:a,spuSaleAttrValueList:[]};this.spu.spuSaleAttrList.push(s),this.attrId=""},submitForm:function(){var t=this;return Object(f["a"])(Object(p["a"])().mark((function e(){var a;return Object(p["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.spu.spuImageList=t.spuImgList.map((function(t){return{imageName:t.name,imageUrl:t.response&&t.response.data||t.url}})),e.next=3,S(t.spu);case 3:a=e.sent,200===a.code&&(t.$message({type:"success",message:t.spu.id?"修改成功":"添加成功"}),t.getSpuList(),t.showSpu=!1);case 5:case"end":return e.stop()}}),e)})))()},addSku:function(t){var e=this;return Object(f["a"])(Object(p["a"])().mark((function a(){var n,s,i;return Object(p["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.skuInfo=Object(r["a"])({},e.defaultSkuInfo),e.showSku=!0,e.skuInfo.category3Id=t.category3Id,e.skuInfo.spuId=t.id,e.skuInfo.tmId=t.tmId,e.skuInfo.spuName=t.spuName,a.next=8,I(t.id);case 8:return n=a.sent,200===n.code&&(n.data.forEach((function(t){t.isDefault=0})),e.skuImageList=n.data),a.next=12,y(t.id);case 12:return s=a.sent,200===s.code&&(e.spuSaleAttrList=s.data),a.next=16,w(e.category1Id,e.category2Id,e.category3Id);case 16:i=a.sent,200===i.code&&(e.attrInfoList=i.data);case 18:case"end":return a.stop()}}),a)})))()},handleSelectionChange:function(t){this.selectImageList=t},changeDefault:function(t){this.skuImageList.forEach((function(t){t.isDefault=0})),t.isDefault=1,this.skuInfo.skuDefaultImg=t.imgUrl},submitSku:function(){var t=this;return Object(f["a"])(Object(p["a"])().mark((function e(){var a,n,s,r,i;return Object(p["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.attrInfoList,n=t.skuInfo,s=t.spuSaleAttrList,r=t.selectImageList,a.forEach((function(t){if(t.attrIdAndValueId){var e=t.attrIdAndValueId.split(":"),a=d(e,2),s=a[0],r=a[1],i={attrId:s,valueId:r};n.skuAttrValueList.push(i)}})),n.skuSaleAttrValueList=s.reduce((function(t,e){if(e.attrIdAndValueId){var a=e.attrIdAndValueId.split(":"),n=d(a,2),s=n[0],r=n[1];t.push({saleAttrId:s,saleAttrValueId:r})}return t}),[]),n.skuImageList=r.map((function(t){return{imgName:t.imgName,imgUrl:t.imgUrl,isDefault:t.isDefault,spuImgId:t.id}})),e.next=6,L(n);case 6:i=e.sent,200===i.code&&(t.$message({type:"success",message:"添加SKU成功"}),t.showSku=!1);case 8:case"end":return e.stop()}}),e)})))()},SkuList:function(t){var e=this;return Object(f["a"])(Object(p["a"])().mark((function a(){var n;return Object(p["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return e.skuList=[],e.showSkuList=!0,e.loading=!0,e.spuName=t.spuName,a.next=6,A(t.id);case 6:n=a.sent,200===n.code&&(e.skuList=n.data,e.loading=!1);case 8:case"end":return a.stop()}}),a)})))()}}},V=x,N=(a("7220"),a("2877")),j=Object(N["a"])(V,n,s,!1,null,null,null);e["default"]=j.exports},d58f:function(t,e,a){var n=a("1c0b"),s=a("7b0b"),r=a("44ad"),i=a("50c4"),u=function(t){return function(e,a,u,l){n(a);var o=s(e),c=r(o),d=i(o.length),p=t?d-1:0,f=t?-1:1;if(u<2)while(1){if(p in c){l=c[p],p+=f;break}if(p+=f,t?p<0:d<=p)throw TypeError("Reduce of empty array with no initial value")}for(;t?p>=0:d>p;p+=f)p in c&&(l=a(l,c[p],p,o));return l}};t.exports={left:u(!1),right:u(!0)}}}]);